---
title : 'Krysten Thompson w271: Homework 8'
author: "Professor Jeffrey Yau"
output: 
  pdf_document:
  toc: true
  number_sections: true
fontsize: 11pt
geometry: margin=1in
---



In the last live session, I demonstrated a complete worked-out example and had you repeated the process using another series.  In this week's homework, you will continue with the exercise using another data series `series3.csv`. Your task is to (1) build a time series model using the `arima()` function and the class of ARMA model, which includes AR, MA, and ARMA models and (2) conduct a **3-step** ahead foreast. 

The ARMA time series model building process, which I outlined both in the async lecture and demonstrated in the last live session (for the AR and MA models), typically includes (1) a time series EDA, which requires an examination of the stationarity of the series and a determination of whether the class of ARMA model is a "reasonable" model as a starting point, (2) model estimation (perhaps a few models need to be attempted), (3) model selection based on some metrics, say AIC, (4) model diagnostic, and (5) model forecast (after a valid model is found). You need to explain why certain AR/MA/ARMA model is chosen as a starting point based on your time series EDA.

```{r message=FALSE}
library(car)
library(dplyr)
library(astsa)
library(forecast)
#library(fpp2)
library(ggplot2)
library(plotly)

# Insert the function to *tidy up* the code when they are printed out
library(knitr)
opts_chunk$set(tidy.opts=list(width.cutoff=60),tidy=TRUE)
```

```{r}
df <- read.csv("series3.csv", header = FALSE, sep=",")
head(df)
```

```{r}
str(df)
tail(df)
```

```{r}
#changing dataframe to time series
df.ts <- ts(df)
class(df.ts)
```

```{r}
#exploring 
cycle(df.ts)
```

```{r}
summary(df.ts)
```

**This section begins EDA**

```{r fig.height=4, fig.width=6}
#What does the data look like when plotted against time?

ggplot(df.ts, aes(x=time(df.ts), y=df.ts)) + 
  geom_line(colour = "red", size = 1) +
  ggtitle("Overview of df.ts") +
  theme(axis.title = element_text(size = rel(1.5)))
```
```{r fig.height=4, fig.width=6}
#Histograms aren't the most useful when exploring time series data but I still wanted to see what it looked like; for the most part, the data looks normally distributed with a slight left-skew

hist(df.ts)
```


```{r}
#I know there aren't column headers and data is not defined by specific time (e.g. week, month, quarter), but I thought it was interesting to see the one outlier

boxplot(df.ts ~ cycle(df.ts))
```


```{r}
#The acf plot below shows a sharp drop-off after lag 1

acf(df.ts)
```

```{r}
pacf(df.ts)
```


```{r}
#Here we see first-order difference in ACF for df.ts and can see a slight
#pattern in the first 4 steps
acf(diff(df.ts))
```

**This begins the modeling section**

```{r}
#First a simple AR model with no order specifications
mod_ar <- ar(df.ts)
summary(mod_ar)
mod_ar$ar
mod_ar$order
mod_ar$aic
checkresiduals(mod_ar)
```

**Residuals plot indicates that this is not white noise.**

```{r}
#Simple AR model with order 5 (I arbitrarily chose 5)
AR.df.ts <- ar(df.ts, order.max=5)
summary(AR.df.ts)
AR.df.ts$ar
AR.df.ts$order
AR.df.ts$aic
checkresiduals(AR.df.ts)
```


```{r}
df.ts.ma <- arima(df.ts, order=c(0,0,1))
df.ts.ma
```

```{r}
acf((df.ts.ma$res[-1]))
```

```{r}
df.ts.ma2 <- arima(df.ts, order = c(0,0,1))
df.ts.ar2 <- arima(df.ts, order = c(1,0,0))
df.ts.arma <- arima(df.ts, order = c(1,0,1))
```

```{r}
#AICs for each model
AIC(df.ts.ma2)
AIC(df.ts.ar2)
AIC(df.ts.arma)
```
**AICs for each model (ar, ma, arma) are very high. This is bad.**

```{r}
#Since no seasonality was apparent in the data, seasonal = FALSE

fit <- auto.arima(df.ts, seasonal=FALSE)
fit
```

```{r}
checkresiduals(fit)
```

```{r}
Box.test(fit$residuals,  type='Ljung-Box')
```
```{r}
#Below plots the inverse roots for p and q
#The red dots are all inside the circles which indicates the ARIMA model above is both stationary and inverticle; we would expect this because we called auto.arima which fit the best ARIMA(p, d, q)
autoplot(fit)
```


```{r}
autoplot(forecast(fit))
```



```{r}
fit.custom <- Arima(df.ts, order=c(5, 1, 3))
summary(fit.custom)
```

```{r}
checkresiduals(fit.custom)
```

```{r}
Box.test(fit.custom$residuals,  type='Ljung-Box')
```

```{r}
fcast <- forecast(fit, h=3)

autoplot(fcast) + ggtitle("Forecast 3 steps") + xlab("Time") + ylab("Forecast")
```

```{r}

```


